<!DOCTYPE html>
<html>
<head>
    <title>maptalks.markercluster demo</title>
    <!-- <script type="text/javascript" src="/maptalks/dist/maptalks.js"></script> -->
    <!-- <script type="text/javascript" src="https://unpkg.com/maptalks-gl/dist/maptalks-gl.js"></script> -->
     <script type="text/javascript" src="/maptalks/dist/maptalks.js"></script>
     <script type="text/javascript" src="/gl/packages/gpu/dist/maptalksgpu.js"></script>
     <script type="text/javascript" src="/gl/packages/vt/dist/maptalks.vt.js"></script>
    <link type="text/css" rel="stylesheet" href="https://unpkg.com/maptalks-gl/dist/maptalks-gl.css">
    <script type="text/javascript" src="../dist/maptalks.markercluster.js"></script>
    <script type="text/javascript" src="realworld.50000.1.js"></script>
    <script type="text/javascript" src="realworld.50000.2.js"></script>
    <style>
        html,body{
            margin:0px;
            height: 100%;
            width: 100%;
        }
        #map {
            width: 100%;
            height:100%;
        }
    </style>
</head>
<body>
<!-- <canvas id="debug-text-atlas"></canvas>
 <canvas id="debug-text-sprite"></canvas> -->
<div id="map"></div>
<script type="text/javascript" >
    //This demos is inspired by Leaflet.MarkerCluster
    //https://github.com/Leaflet/Leaflet.markercluster

    var map = new maptalks.Map("map",{
        center:   [175.27, -37.79],
        zoom   :  14,
        centerCross : true,
        renderer: 'gpu',
        baseLayer : new maptalks.TileLayer('tile',{
          urlTemplate: 'https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}.png',
          subdomains: ['a','b','c','d'],
          attribution: '&copy; <a href="http://osm.org">OpenStreetMap</a> contributors, &copy; <a href="https://carto.com/">CARTO</a>'
        })
    });

    var markers = [];
    // data from realworld.50000.1.js
    for (var i = 0; i < addressPoints.length; i++) {
        var a = addressPoints[i];
        markers.push(new maptalks.Marker([a[1], a[0]]).on('mousedown', onClick));
    }
    // data from realworld.50000.2.js
    for (var i = 0; i < addressPoints2.length; i++) {
        var a = addressPoints2[i];
        markers.push(new maptalks.Marker([a[1], a[0]]).on('mousedown', onClick));
    }

    var clusterLayer = new maptalks.ClusterLayer('cluster', markers, {
        'noClusterWithOneMarker' : false,
        'maxClusterZoom' : 18,
        // 'drawClusterText': false,
        // 'animation': false,
        // renderer: 'canvas',
        //"count" is an internal variable: marker count in the cluster.
        'symbol': {
            'markerType' : 'ellipse',
            'markerFill' : { property:'count', type:'interval', stops: [[0, 'rgb(135, 196, 240)'], [9, '#1bbc9b'], [99, 'rgb(216, 115, 149)']] },
            'markerFillOpacity' : 0.7,
            'markerLineOpacity' : 1,
            'markerLineWidth' : 3,
            'markerLineColor' : '#fff',
            'markerWidth' : { property:'count', type:'interval', stops: [[0, 40], [9, 60], [99, 80]] },
            'markerHeight' : { property:'count', type:'interval', stops: [[0, 40], [9, 60], [99, 80]] }
        },
        'geometryEvents' : true,
        'single': true
    });

    map.addLayer(clusterLayer);

    map.on('click', function (e) {
        // console.log(clusterLayer.identify(e.coordinate));
        console.log(e);
    });

    function onClick(e) {
        console.log(e.target);
    }
</script>
</body>
</html>
